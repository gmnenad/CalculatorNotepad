// STATS
pY=0.009 // prior probability that one Serbian get COVID ( ~ 20k/6M in 2 week )
pN=1-pY // prior probability NOT to get COVID
pFP=0.005 // false positive rate of test
pFN=0.13 // false negative rate of test



// BAYES 1 - first individual chance to have, then for all 3
pCP= pY*(1-pFP)/(pY*(1-pFP)+pN*pFP) // prob for SINGLE PERSON to have COVID if positive test
pCN= pY*pFN/(pY*pFN+pN*(1-pFN)) // prob to have COVID if negative test

// if 2 have positive test and one negative, but SAME infection
// probability all 3 have COVID=?

pYC= pCP^2*pCN
pNC=(1-pCP)^2*(1-pCN)

pC1= pYC/(pYC+pNC) // prob all 3 to have COVID

// BAYES 2 - start with chance all 3 to have, assume SAME as single person ( since they all were at same meeting )
pP2= pY*(1-pFP)^2*pFN // prob to belong to group who really have and two positive tests are ok but one negative is false
pN2= pN*pFP^2*(1-pFN) // prob to belong to group that does nto have, so two positives are false and negative test is correct 
PC2= pP2/(pP2+pN2) // overall prob to have - this assume combined prior for all 3 together

// BAYES 3 - vs influenza , considering they had simptoms
fluWeekly= 1.1*666 // based on 1.1 per 100k influenza number in one week in UK, and 66.6M population [ bad - lwoer flu than rest of EU ]
fluWeekly= 15900// based on 6day 13616 influenza ( 7day ~ 15900) in 2018 [ bad - long ago ]
fluWeekly= 7230 // based on 43388 influenza in SRB by 18.01 ( assuming seazon started december, thats ~ 7230 per week )

pY= 31381/(fluWeekly+31381)  
pN=1-pY
pP3= pY*(1-pFP)^2*pFN // prob to belong to group who really have and two positive tests are ok but one negative is false
pN3= pN*pFP^2*(1-pFN) // prob to belong to group that does nto have, so two positives are false and negative test is correct 
PC3= pP3/(pP3+pN3) // overall prob to have - this assume combined prior for all 3 together

// BAYES 4 - based on est COVID vs FLU per 100k/week, if all had symptoms   [ ~ 80% chance they all have COVID ]
fluWK= 120 // based on 43388 influenza in SRB by 18.01 ( assuming seazon started december, thats ~ 7230 per week , or ~120 per 100k per week )
covidWK= 450 // based on 31381 covid in this week and 17% increase to last week, and 6M population ( 60*100k pop )
pY=covidWK/(covidWK+fluWK)
pN=1-pY
nP=1 // number of people who had positive result
nN=3 // number of people who had negative result
pFP=0.005 // false positive rate of test
pFN=0.15 // false negative rate of test

pP4= pY*(1-pFP)^nP*pFN^nN // prob to have covid in general (prior) and to have two positive tests valid but one negative is false
pN4= pN*pFP^nP*(1-pFN)^nN // prob not to have covid in general (prior) and to have two positive tests false and one negative test valid
PC4= pP4/(pP4+pN4) // overall prob to have - this assume combined prior for all 3 together

// BAYES 5 - if only person with positive result did NOT have symptoms?   [ ~ 70% chance they all have COVID ]
pY1=covidWK/100000
pN1=1-pY1

pCS= pY*pFN^nN/(pY*pFN^nN+pN*(1-pFN)^nN)  // probability that people with symptoms ( and negative results) have COVID
pCN= pY1*(1-pFP)^nP/(pY1*(1-pFP)^nP+pN1*pFP^nP) // probability that people without symptoms ( and positive results) have COVID
pCovidA= pCS*pCN/(pCS*pCN+(1-pCS)*(1-pCN)) // probability they all have COVID

pYes= pY*pFN^nN * pY1*(1-pFP)^nP // probability that both people with symptoms (and neg result) ant without symptoms ( but pos results ) have covid
pNo= pN*(1-pFN)^nN * pN1*pFP^nP // probability they both do not have covid
pCOVID= pYes/(pYes+pNo)  // probability they all have COVID, same as above approach




// Arbitrary number of people with symptoms or not, and positive or negative test results
nSP=1 // number of people with symptoms and positive results
nSN=3 // number of people with symptoms and negative results
nNP=0 // number of people WITHOUT symptoms and with positive results
nNN=0 // number of people WITHOUT symptoms and with negative results

pX(vp, vn )={ // probability they ALl have covid, given individual probabilities and number of people with each
    my=1;
    mn=1;
    for(i=0, i<vLen(vp), i=i+1){
       my=my*vp[i]^vn[i];
       mn=mn*(1-vp[i])^vn[i];
    }
    return my/(my+mn);
}

// probabilities for groups with/without symptoms, where first element is prior probability that group has covid
// - alternative approach: replace vec(1,.. with vec(n?P+n?N ,.. - if prior is independent for each person (which it is not)
pSX= pX( vec(covidWK/(covidWK+fluWK), 1-pFP, pFN), vec(1, nSP, nSN )) // probability all of those with symptoms to have covid, first element is prior
pNX= pX( vec(covidWK/100000         , 1-pFP, pFN), vec(1, nNP, nNN )) // probability all of those without symptoms to have covid

pRes= pX( vec(pSX, pNX), vec(if(nSP+nSN>0,1,0),if(nNP+nNN>0,1,0)) ) // probability they all  have covid

